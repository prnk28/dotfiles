#!/bin/bash

# tmux-sessions - Interactive tmuxinator project selector with fzf popup

set -euo pipefail

# Check if tmuxinator is available
if ! command -v tmuxinator &>/dev/null; then
    echo "Error: tmuxinator is not installed or not in PATH" >&2
    exit 1
fi

# Check if fzf is available
if ! command -v fzf &>/dev/null; then
    echo "Error: fzf is not installed or not in PATH" >&2
    exit 1
fi

# Get list of tmuxinator projects
projects=$(tmuxinator list -s 2>/dev/null | tail -n +2)

# Check if there are any projects
if [ -z "$projects" ]; then
    echo "No tmuxinator projects found"
    exit 1
fi

# Use fzf to select a project with tmux popup
selected_project=$(echo "$projects" | fzf --tmux --prompt="Project: ")

# Exit if no selection was made
if [ -z "$selected_project" ]; then
    echo "No project selected"
    exit 0
fi

# Start the selected tmuxinator project
echo "Starting tmuxinator project: $selected_project"
exec tmuxinator start "$selected_project"
