#!/bin/bash
set -euo pipefail

echo "ğŸ”„ Refreshing Doppler secrets..."

# Ensure we're logged in
if ! doppler me &> /dev/null; then
    echo "âŒ Not logged into Doppler. Running 'doppler login'..."
    doppler login
fi

# Update chezmoi with latest secrets
echo "ğŸ“¥ Pulling latest secrets from Doppler..."
chezmoi apply --refresh-externals

echo "âœ… Doppler secrets refreshed!"
echo "   Restart your shell or run 'source ~/.config/doppler/env.sh' to load new values"
