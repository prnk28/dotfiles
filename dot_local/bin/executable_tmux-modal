#!/bin/bash

# tmux-modal - Display a tmux popup with a passable argument for setting to execute in the current working directory

set -euo pipefail

# Check if tmux is available
if ! command -v tmux &>/dev/null; then
    echo "Error: tmux is not installed or not in PATH" >&2
    exit 1
fi

# Check if a command string was passed as an argument
if [ "$#" -eq 0 ]; then
    echo "Usage: $0 \"<command> [args...]\"" >&2
    echo "Note: The command and its arguments must be passed as a single quoted string." >&2
    exit 1
fi

# Default variables
WIDTH=50%
HEIGHT=80%
COMMAND_STRING="$*"
CWD=$(pwd)

# Extract just the command from the beginning of the string for validation
# This reads the first whitespace-separated word into the variable.
read -r command _ <<<"$COMMAND_STRING"

# Check if the command exists
if ! command -v "$command" &>/dev/null; then
    echo "Error: command '$command' not found in PATH" >&2
    exit 1
fi

# Run tmux display-popup.
# -w, -h: Set the dimensions of the popup.
# -d "$CWD": Sets the working directory for the command. This is cleaner than `cd ... && ...`.
# --: Signals the end of tmux options.
# "$COMMAND_STRING": The command to execute within the new popup's shell.
tmux display-popup -w "$WIDTH" -h "$HEIGHT" -d "$CWD" -- "$COMMAND_STRING"
