#!/bin/bash
TEMP_HISTORY="/tmp/chrome_history_$(date +%s).db"
cp "$HOME/.config/chromium/Profile 2/History" "$TEMP_HISTORY"

gum style --align center --padding "0 1" --foreground 190 --border double --border-foreground 190 "ï‰¨ Browser History"

sqlite3 -separator $'\t' "$TEMP_HISTORY" \
  "SELECT datetime(last_visit_time/1000000-11644473600,'unixepoch','localtime'), 
          url, 
          title 
   FROM urls 
   ORDER BY last_visit_time DESC 
   LIMIT 10000" | \
  fzf \
    --border=none \
    --delimiter=$'\t' \
    --with-nth=1,3 \
    --preview 'echo {2}' \
    --preview-window=down:3:wrap \
    --bind 'enter:execute(xdg-open {2})+abort' \
    --bind 'y:execute-silent(echo -n {2} | wl-copy)+abort' \
    --bind 'ctrl-t:execute-silent(echo -n {3} | wl-copy)' \
    --bind 'm:execute(/home/prad/.local/bin/mdcp {2})+abort' \
    --height 92% \
    --header 'Enter: open | y: yank URL | Ctrl-T: yank title | m: mdcp'

rm "$TEMP_HISTORY"
