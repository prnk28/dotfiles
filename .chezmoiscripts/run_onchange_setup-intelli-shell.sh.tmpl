#!/usr/bin/env bash
# Setup intelli-shell with custom commands

set -e

# Only run if intelli-shell is installed
if ! command -v intelli-shell &> /dev/null; then
    echo "intelli-shell not found, skipping setup"
    exit 0
fi

echo "Setting up intelli-shell custom commands..."

# Function to add command if not already exists
add_command() {
    local cmd="$1"
    local alias="$2"
    local description="$3"

    # Add the command (intelli-shell handles duplicates)
    intelli-shell new "$cmd" --alias "$alias" --description "$description" 2>/dev/null || true
}

# Claude commands
add_command "claude -r --dangerously-skip-permissions" "claude" "Launch Claude Code in current repo with full permissions"
add_command "claude --dangerously-skip-permissions" "/c" "Launch Claude Code with full permissions (new session)"
add_command "claude --dangerously-skip-permissions --continue" "/cc" "Continue Claude Code session"
add_command "claude --dangerously-skip-permissions --resume" "/cr" "Resume Claude Code session"
add_command "opencode" "/o" "Open code in default editor"
add_command "rclone copy -P r2:claude .claude" "claude-init" "Initialize Claude data from R2 storage"
add_command "rclone sync -P .claude r2:claude" "claude-sync" "Sync Claude data to R2 storage"

# GitHub commands
add_command "github issues" "ghi" "Open GitHub issues selector with fzf"
add_command "github prs" "ghp" "Open GitHub PRs selector with fzf"
add_command "github actions" "gha" "Open GitHub Actions runs selector with fzf"

# Devbox command
add_command "devbox-run" "dxr" "Select and run a devbox script with fzf"

# TLDraw command
add_command "tdrw" "td" "Open TLDraw file selector with fzf"

# Chezmoi commands
add_command "chezmoi update" "cmu" "Update dotfiles from remote and apply changes"
add_command "chezmoi apply" "cm." "Apply dotfiles changes to system"
add_command "chezmoi edit" "cme" "Edit a dotfile in chezmoi source state"

# Filesystem commands
add_command "yy" "y" "Open Yazi file manager with automatic cd to selection"
add_command "cd ~/.local/share" "cdl" "Change to local share directory"
add_command "cd -" "cb" "Change to previous directory"
add_command "cd .." ".." "Go up one directory"
add_command "chezmoi cd" "cd." "Change to chezmoi source directory"

# Git/GitHub aliases
add_command "lazygit" "gg" "Launch lazygit TUI"
add_command "gh dash" "ghd" "Open GitHub dashboard"
add_command "git push --set-upstream origin HEAD" "gpu" "Push current branch and set upstream"
add_command "git switch -" "gsb" "Switch to previous git branch"
add_command "git diff" "gdf" "Show git diff"
add_command "ghq list" "ghl" "List all ghq repositories"
add_command "edit_files" "e" "Edit files in git repo with fzf selector"
add_command "open_repo" "o" "Open repository from ghq with fzf selector"
add_command "open_lazycommit" "gc" "Open lazycommit for AI-generated commit messages"

# Docker Compose services
add_command "task -g services:start:openwebui" "openwebui-start" "Start OpenWebUI service"
add_command "task -g services:stop:openwebui" "openwebui-stop" "Stop OpenWebUI service"
add_command "task -g services:restart:openwebui" "openwebui-restart" "Restart OpenWebUI service"
add_command "task -g services:start:flame" "flame-start" "Start Flame dashboard service"
add_command "task -g services:stop:flame" "flame-stop" "Stop Flame dashboard service"
add_command "task -g services:start:n8n" "n8n-start" "Start n8n workflow automation service"
add_command "task -g services:stop:n8n" "n8n-stop" "Stop n8n workflow automation service"

# SSH commands - generic
add_command "sshc" "sshc" "Run command on all SSH servers"
add_command "sshs" "sshs" "Select and connect to SSH server with fzf"
add_command "sshb" "sshb" "Run command on build servers"
add_command "ssht" "ssht" "Run command on testnet servers"
add_command "sshg" "sshg" "Run command on gateway servers"

# SSH commands - specific hosts
add_command "ssh bos-kvm-8" "ssh-bos8" "SSH to Boston KVM-8 server (72.60.121.60)"
add_command "ssh bos-kvm-4" "ssh-bos4" "SSH to Boston KVM-4 server (100.87.170.34)"
add_command "ssh phx-kvm-8" "ssh-phx8" "SSH to Phoenix KVM-8 server (193.203.164.150)"
add_command "ssh phx-kvm-2" "ssh-phx2" "SSH to Phoenix KVM-2 server (100.127.253.117)"
add_command "ssh gateway-bos" "ssh-gateway" "SSH to Boston Gateway server (100.65.108.79)"
add_command "ssh testnet-phx" "ssh-testnet" "SSH to Phoenix Testnet server (100.87.11.72)"

# Shell utilities
add_command "today" "tdy" "Get current date in YYYY.WW.D format"
add_command "q" "q" "Smart quit (detaches from tmux popup or exits)"
add_command "c" "c" "Clear screen or cd to directory with zoxide"

# System update
add_command "refresh-global && source ~/.zshrc && exec zsh" "reload" "Reload zsh configuration and refresh global environment"

echo "âœ“ intelli-shell custom commands configured"
