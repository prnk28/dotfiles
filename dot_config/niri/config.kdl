// Niri configuration
// Converted from Hyprland config at ~/.config/hypr/

// ============================================================================
// Input Configuration
// ============================================================================
input {
    keyboard {
        xkb {
            layout "us"
            // Use Caps Lock as Compose key
            options "compose:caps"
        }

        repeat-delay 220
        repeat-rate 50
    }

    touchpad {
        tap
        dwt  // disable-while-typing
        dwtp // disable-while-trackpointing
        natural-scroll
        click-method "clickfinger"
        scroll-method "two-finger"
        accel-speed 0.65
        accel-profile "adaptive"
        tap-button-map "left-middle-right"
    }

    mouse {
        accel-speed 0.65
        accel-profile "adaptive"
    }

    tablet {
        map-to-output "Tianma Microelectronics Ltd. TL134ADXP03"
    }

    touch {
        map-to-output "Tianma Microelectronics Ltd. TL134ADXP03"
    }

    focus-follows-mouse
    workspace-auto-back-and-forth
}

// ============================================================================
// Output Configuration
// ============================================================================
output "Tianma Microelectronics Ltd. TL134ADXP03" {
    mode "2880x1920@120.000"
    scale 2.0
    position x=1400 y=0
}

output "Apple Computer Inc StudioDisplay 0x42F1A951" {
    scale 2.0
    position x=0 y=-1400
}

output "Samsung Electric Company S34CG50 HNTY501103" {
    scale 1.0
    position x=0 y=-1400
}

// ============================================================================
// Layout Configuration
// ============================================================================
layout {
    gaps 8

    center-focused-column "never"

    preset-column-widths {
        proportion 0.33333
        proportion 0.5
        proportion 0.66667
    }

    default-column-width { proportion 0.5; }

    focus-ring {
        width 2
        active-color "#89b4fa"
        inactive-color "#313244"

        // Smooth transitions
        active-gradient from="#89b4fa" to="#b4befe" angle=45
    }

    border {
        width 1
        active-color "#89b4fa"
        inactive-color "#313244"

        active-gradient from="#89b4fa" to="#b4befe" angle=45
    }

    struts {
        left 0
        right 0
        top 0
        bottom 0
    }
}

// ============================================================================
// Animations
// ============================================================================
animations {
    // Enable smooth animations matching Hyprland's "overshot" feel
    slowdown 1.0

    window-open {
        duration-ms 250
        curve "ease-out-expo"
    }

    window-close {
        duration-ms 200
        curve "ease-out-expo"
    }

    window-movement {
        duration-ms 200
        curve "ease-out-cubic"
    }

    window-resize {
        duration-ms 200
        curve "ease-out-cubic"
    }

    workspace-switch {
        duration-ms 300
        curve "ease-out-expo"
    }

    config-notification-open-close {
        duration-ms 200
    }
}

// ============================================================================
// Window Rules
// ============================================================================
window-rule {
    match app-id=r#"^com\.mitchellh\.ghostty$"#
    default-column-width { proportion 0.5; }
    min-width 1200
    min-height 800
}

window-rule {
    match app-id=r#"^TUI\.float$"#
    default-column-width { proportion 0.5; }
    min-width 1200
    min-height 800
}

window-rule {
    match app-id=r#"^vicinae$"#
    focus-ring { off; }
    border { off; }
}

window-rule {
    match app-id=r#"^alacritty$"#
    open-on-output "Samsung Electric Company S34CG50 HNTY501103"
}

window-rule {
    match app-id=r#"^chromium$"#
    open-on-output "Samsung Electric Company S34CG50 HNTY501103"
}

window-rule {
    match title=r#"^tldraw Editor$"#
    open-on-output "Tianma Microelectronics Ltd. TL134ADXP03"
    open-on-workspace "9"
}

window-rule {
    match app-id=r#"^chrome-figma\.com__-Default$"#
    open-on-output "Tianma Microelectronics Ltd. TL134ADXP03"
}

window-rule {
    match app-id=r#"^chrome-app\.eraser\.io__dashboard-Default$"#
    open-on-output "Tianma Microelectronics Ltd. TL134ADXP03"
    open-on-workspace "9"
}

window-rule {
    match app-id=r#"^chrome-umbrel\.local__-Profile_2$"#
    open-on-output "Tianma Microelectronics Ltd. TL134ADXP03"
}

window-rule {
    match app-id=r#"^chrome-claude\.ai__-Default$"#
    open-on-output "Tianma Microelectronics Ltd. TL134ADXP03"
}

window-rule {
    match app-id=r#"^chrome-youtube\.com__-Default$"#
    open-on-output "Tianma Microelectronics Ltd. TL134ADXP03"
}

// ============================================================================
// Key Bindings
// Matches Hyprland config: Super for apps, Alt for window/workspace management
// ============================================================================
binds {
    // Help overlay
    Super+Shift+Slash { show-hotkey-overlay; }

    // ========================================================================
    // Window Management (Alt-based, matching Hyprland)
    // ========================================================================
    Super+Q { close-window; }
    Super+W { close-window; }

    // Focus movement (Alt + Vim keys, matching Hyprland)
    Alt+H { focus-column-left; }
    Alt+J { focus-window-down; }
    Alt+K { focus-window-up; }
    Alt+L { focus-column-right; }
    Alt+Left { focus-column-left; }
    Alt+Down { focus-window-down; }
    Alt+Up { focus-window-up; }
    Alt+Right { focus-column-right; }

    // Move windows (Alt+Shift + Vim keys)
    Alt+Shift+H { move-column-left; }
    Alt+Shift+J { move-window-down; }
    Alt+Shift+K { move-window-up; }
    Alt+Shift+L { move-column-right; }
    Alt+Shift+Left { move-column-left; }
    Alt+Shift+Down { move-window-down; }
    Alt+Shift+Up { move-window-up; }
    Alt+Shift+Right { move-column-right; }

    // Window resizing (Alt+Ctrl + Vim keys)
    Alt+Ctrl+H { set-column-width "-10%"; }
    Alt+Ctrl+L { set-column-width "+10%"; }
    Alt+Ctrl+J { set-window-height "-10%"; }
    Alt+Ctrl+K { set-window-height "+10%"; }

    // Toggle fullscreen and maximize
    Alt+Space { fullscreen-window; }
    Alt+Shift+Space { maximize-column; }

    // Column width presets (using different keys to avoid conflicts)
    Super+Minus { switch-preset-column-width; }
    Super+Equal { reset-window-height; }

    // Center column (using different key to avoid Super+C conflict with clipboard)
    Super+Shift+C { center-column; }

    // Consume/expel from column (these conflict with app launchers, removing)
    // Super+Comma { consume-window-into-column; }
    // Super+Period { expel-window-from-column; }


    // ========================================================================
    // Monitor Management
    // ========================================================================
    Super+Shift+Left { focus-monitor-left; }
    Super+Shift+Right { focus-monitor-right; }
    Super+Shift+Down { focus-monitor-down; }
    Super+Shift+Up { focus-monitor-up; }

    Super+Ctrl+Shift+Left { move-window-to-monitor-left; }
    Super+Ctrl+Shift+Right { move-window-to-monitor-right; }
    Super+Ctrl+Shift+Down { move-window-to-monitor-down; }
    Super+Ctrl+Shift+Up { move-window-to-monitor-up; }

    // ========================================================================
    // Application Launchers
    // ========================================================================
    // Launcher
    Super+Space { spawn "vicinae" "vicinae://toggle"; }
    Ctrl+Space { spawn "vicinae" "vicinae://toggle"; }
    Super+Shift+Space { spawn "vicinae" "vicinae://extensions/vicinae/wm/switch-windows"; }
    Super+Shift+E { spawn "vicinae" "vicinae://extensions/vicinae/vicinae/search-emojis"; }
    Super+Shift+V { spawn "vicinae" "vicinae://extensions/vicinae/clipboard/history"; }
    Super+Shift+Comma { spawn "vicinae" "vicinae://settings/open?tab=extensions"; }

    // Main applications
    Super+N { spawn "uwsm" "app" "--" "alacritty" "--working-directory=$(omarchy-cmd-terminal-cwd)"; }
    Super+T { spawn "uwsm" "app" "--" "chromium" "--new-tab" "--disable-session-crashed-bubble" "https://github.com/sonr-io/sonr"; }
    Super+Shift+N { spawn "uwsm" "app" "--" "chromium" "--incognito" "--disable-session-crashed-bubble"; }
    Super+F { spawn "uwsm" "app" "--" "nautilus" "--new-window"; }
    Super+E { spawn "uwsm" "app" "--" "ghostty" "--class=TUI.tile" "--working-directory=$(omarchy-cmd-terminal-cwd)" "-e" "nvim"; }
    Super+O { spawn "uwsm" "app" "--" "ghostty" "--working-directory=$(omarchy-cmd-terminal-cwd)" "-e" "tv" "repos"; }
    Super+Period { spawn "uwsm" "app" "--" "ghostty" "--working-directory=$(omarchy-cmd-terminal-cwd)" "-e" "yazi"; }
    Super+G { spawn "uwsm" "app" "--" "alacritty" "--class=TUI.float" "--config-file=$XDG_CONFIG_HOME/alacritty/float.toml" "--working-directory=$(omarchy-cmd-terminal-cwd)" "-e" "lazygit"; }
    Super+K { spawn "uwsm" "app" "--" "alacritty" "--class=TUI.tile" "--config-file=$XDG_CONFIG_HOME/alacritty/tile.toml" "--working-directory=$(omarchy-cmd-terminal-cwd)" "-e" "lazyssh"; }
    Super+D { spawn "uwsm" "app" "--" "alacritty" "--class=TUI.float" "--config-file=$XDG_CONFIG_HOME/alacritty/float.toml" "--working-directory=$(omarchy-cmd-terminal-cwd)" "-e" "gh" "dash"; }
    Super+A { spawn "uwsm" "app" "--" "alacritty" "--class=TUI.tile" "--config-file=$XDG_CONFIG_HOME/alacritty/tile.toml" "--working-directory=$(omarchy-cmd-terminal-cwd)" "-e" "claude"; }
    Super+Comma { spawn "uwsm" "app" "--" "alacritty" "--working-directory=/home/prad/.local/share/chezmoi" "-e" "nvim"; }

    // Quick launch or focus
    Ctrl+Super+Alt+K { spawn "omarchy-launch-or-focus" "chromium"; }
    Ctrl+Super+Alt+J { spawn "omarchy-launch-or-focus" "alacritty"; }

    // Web apps
    Super+Shift+A { spawn "omarchy-launch-or-focus-webapp" "Grok" "https://grok.com"; }
    Super+Y { spawn "omarchy-launch-or-focus-webapp" "YouTube" "https://youtube.com"; }
    Super+Shift+Y { spawn "omarchy-launch-or-focus-webapp" "Netflix" "https://netflix.com/browse"; }
    Super+Shift+M { spawn "omarchy-launch-or-focus-webapp" "Music" "https://music.youtube.com/"; }
    Super+Shift+T { spawn "omarchy-launch-or-focus-webapp" "TLDraw" "https://tldraw.com"; }
    Ctrl+Super+Alt+X { spawn "omarchy-launch-or-focus-webapp" "X" "https://x.com"; }
    Ctrl+Super+Alt+T { spawn "omarchy-launch-or-focus-webapp" "Telegram" "https://web.telegram.org"; }
    Ctrl+Super+Alt+C { spawn "omarchy-launch-or-focus-webapp" "Calendar" "https://calendar.notion.so"; }
    Ctrl+Super+Alt+D { spawn "omarchy-launch-or-focus-webapp" "Discord" "https://discord.com/channels/@me"; }
    Ctrl+Super+Alt+O { spawn "omarchy-launch-or-focus-webapp" "Obsidian" "https://obsidian.md"; }
    Ctrl+Super+Alt+B { spawn "omarchy-launch-or-focus-webapp" "Messenger" "https://messenger.com/t/1630743130269993"; }
    Ctrl+Super+Alt+E { spawn "omarchy-launch-or-focus-webapp" "Email" "https://mail.notion.so"; }
    Ctrl+Super+Alt+F { spawn "omarchy-launch-or-focus-webapp" "Figma" "https://figma.com/files/team/1282750888814227547"; }
    Ctrl+Super+Alt+A { spawn "omarchy-launch-or-focus-webapp" "Claude" "https://claude.ai"; }

    // ========================================================================
    // Screenshots
    // ========================================================================
    Print { spawn "omarchy-cmd-screenshot"; }

    // ========================================================================
    // System controls
    // ========================================================================
    Super+Shift+P { quit; }
    Super+Shift+Ctrl+T { toggle-debug-tint; }

    // Clipboard
    Super+C { spawn "wl-copy"; }
    Super+V { spawn "wl-paste"; }
}

// ============================================================================
// Miscellaneous Settings
// ============================================================================
prefer-no-csd

screenshot-path "~/Pictures/Screenshots/Screenshot from %Y-%m-%d %H-%M-%S.png"

hotkey-overlay {
    skip-at-startup
}

// ============================================================================
// Debug Settings
// ============================================================================
debug {
    // Uncomment for debugging
    // render-drm-device "/dev/dri/renderD128"
    // wait-for-frame-completion-before-queueing
    // enable-color-transformations-capability
}

// ============================================================================
// Cursor Configuration
// ============================================================================
cursor {
    // Use software cursor if hardware cursors cause issues
    // xcursor-theme "Adwaita"
    // xcursor-size 24
}

// ============================================================================
// Environment Variables
// ============================================================================
environment {
    GDK_SCALE "2"
    QT_QPA_PLATFORM "wayland"
    XCURSOR_SIZE "24"
}

// ============================================================================
// Switch Events (for tablets/convertibles)
// ============================================================================
// Uncomment if you have tablet mode switches
// switch-events {
//     match lid-switch
//     on-lid-close { suspend; }
// }

// ============================================================================
// Gestures
// ============================================================================
// Note: Niri doesn't currently support gesture configuration via config file
// gestures {
//     workspace-swipe {
//         enable
//         fingers 3
//     }
// }
