
# Enable dotfile globbing
setopt glob_dots

# Initialize completions (optimized)
autoload -Uz compinit
{{ if eq .chezmoi.os "darwin" -}}
if [[ -n ${ZDOTDIR}/.zcompdump(#qNmh+24) ]]; then
  compinit
else
  compinit -C
fi
{{ else -}}
# For Linux, use standard completion initialization
if [[ -n ~/.zcompdump(#qNmh+24) ]]; then
  compinit
else
  compinit -C
fi
{{ end -}}

# Add direnv hook
eval "$(direnv hook zsh)"

# Starship configuration
export STARSHIP_CONFIG="$HOME/.config/starship.toml"

# Set editor
export EDITOR=nvim
export VISUAL=nvim

# Add hishtory to PATH early (before it's used by other configurations)
export PATH="{{ .chezmoi.homeDir }}/.hishtory:$PATH"

# Add local bin to PATH
export PATH="{{ .chezmoi.homeDir }}/.local/bin:$PATH"

# Load language/tool specific configurations
{{ template "zsh/golang" . }}
{{ template "zsh/rust" . }}
{{ template "zsh/node" . }}
{{ template "zsh/python" . }}
{{ template "zsh/docker" . }}

# Initialize interactive tools
{{ template "zsh/tools" . }}

# Shell enhancements
{{ template "zsh/enhancements" . }}

# Shared working directory tracking
[[ -f "$HOME/.config/zsh/shared-cwd.zsh" ]] && source "$HOME/.config/zsh/shared-cwd.zsh"

# Platform specific configurations
{{ if eq .chezmoi.os "darwin" -}}
{{ template "zsh/darwin" . }}
{{ else if eq .chezmoi.os "linux" -}}
{{ template "zsh/linux" . }}
{{ end -}}

# User specific aliases
{{ template "zsh/aliases" . }}
{{ template "zsh/functions" . }}

# Load Doppler secrets
if [ -f {{ .chezmoi.homeDir }}/.config/doppler/env.sh ]; then
    source {{ .chezmoi.homeDir }}/.config/doppler/env.sh
fi

# Source custom functions
[[ -f {{ .chezmoi.homeDir }}/.local/bin/gho ]] && source {{ .chezmoi.homeDir }}/.local/bin/gho

# Initialize devbox global environment
eval "$(devbox global shellenv)"
